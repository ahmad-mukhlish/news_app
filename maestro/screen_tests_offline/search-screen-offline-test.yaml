appId: com.newsflash.app
---
# Search Offline Test: Tests search behavior when network is unavailable
# Verifies error handling when attempting to search offline
# Mimics online test flow but expects Error widgets instead of News cards

- runFlow: ../common_tests/setup-offline.yaml

# Navigate to Search tab
- tapOn:
    text: ".*Search tab.*"
- waitForAnimationToEnd

# Verify search screen is visible
- assertVisible: "Search"
- assertVisible: "Search news..."

# Test 1: Search for "technology"
- tapOn: "Search news..."
- inputText: "technology"

# Wait for suggestions to appear (with debounce delay)
- waitForAnimationToEnd:
    timeout: 2000

# Submit search query
- pressKey: Enter

# Wait for search results to load - expect Error in offline mode
- extendedWaitUntil:
    visible: ".*Error.*"
    timeout: 15000

# Verify error state
- assertVisible: ".*Error.*"

# Test retry button
- runFlow: ../common_tests/retry-offline.yaml

# Test 2: Clear search button
- tapOn: ".*Clear search.*"
- waitForAnimationToEnd:
    timeout: 1000
- assertVisible: "Search news..."

# Test 3: Search for "bitcoin"
- tapOn: "Search news..."
- inputText: "bitcoin"
- waitForAnimationToEnd:
    timeout: 2000

# Submit search query (skip suggestion tap in offline mode)
- pressKey: Enter

# Wait for results - expect Error in offline mode
- extendedWaitUntil:
    visible: ".*Error.*"
    timeout: 15000

# Verify error state persists
- assertVisible: ".*Error.*"

# Test retry button again
- runFlow: ../common_tests/retry-offline.yaml

# Edge Case 1: Empty search query
- tapOn: ".*Clear search.*"
- waitForAnimationToEnd:
    timeout: 1000

- tapOn: "Search news..."
# Type nothing and submit
- pressKey: Enter

# Should show empty state or stay in same state
- assertVisible: "Search"

# Edge Case 2: Search with special characters
- tapOn: "Search news..."
- inputText: "!@#$%"
- pressKey: Enter

- waitForAnimationToEnd:
    timeout: 2000

# Verify error state persists
- assertVisible: ".*Error.*"